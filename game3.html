<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tower of Hanoi - Levels</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background:#222; color:#fff; margin:0; padding:0; }
        h1 { margin-top:20px; }
        #startScreen, #instructionScreen, #gameSection { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
        #instructionScreen, #gameSection { display:none; }
        button { padding:12px 24px; margin-top:20px; font-size:18px; font-weight:bold; border:none; border-radius:8px; background:#4facfe; cursor:pointer; transition:0.3s; }
        button:hover { background:#00f2fe; }
        #game { display:flex; justify-content:center; margin-top:50px; gap:60px; }
        .tower { width:120px; height:250px; border:3px solid #fff; display:flex; flex-direction:column-reverse; align-items:center; padding-bottom:10px; cursor:pointer; }
        .disk { height:25px; margin:3px 0; border-radius:5px; background:linear-gradient(to bottom,#4facfe,#00f2fe); color:#000; font-weight:bold; text-align:center; line-height:25px; }
        /* Hides the info bar (Level, Moves, Time) */
        #info { display:none; }
        #message { margin-top:15px; font-size:18px; font-weight:bold; color:#0f0; }
        .instructions-box { background:rgba(255,255,255,0.05); padding:20px; border-radius:10px; max-width:700px; text-align:left; margin-top:20px; }
        .instructions-box ul { margin:10px 0 0 20px; }
    </style>
</head>
<body>
<h1>Tower of Hanoi - Levels</h1>

<div id="startScreen">
    <h2>Welcome to Tower of Hanoi</h2>
    <button onclick="showInstructions()">Enter Game</button>
</div>

<div id="instructionScreen">
    <h2>How to Play</h2>
    <div class="instructions-box">
        <p><b>Start position:</b> All discs are stacked on the first tower.</p>
        <p><b>Goal:</b> Move all discs to the third tower.</p>
        <ul>
            <li>You can move only <b>one disc</b> at a time.</li>
            <li>Only the <b>top disc</b> of a tower can be moved.</li>
            <li>A disc must always be placed on a <b>bigger disc</b>.</li>
            <li>You cannot place a disc on a <b>smaller disc</b>.</li>
            <li>The game has <b>3 levels</b>. Each new level will have one more disc.</li>
            <li><b>How to move:</b> Click on the disc you want to move.</li>
            <li>Your job is simply to complete all 3 levels.</li>
        </ul>
        <p><b>Note:</b> You will not see your score or time. At the end you will only see a completion message.</p>
    </div>
    <button onclick="startGame()">Start Playing</button>
</div>

<div id="gameSection">
    <div id="game">
        <div class="tower" id="tower1"></div>
        <div class="tower" id="tower2"></div>
        <div class="tower" id="tower3"></div>
    </div>
    <!-- Info is hidden but still present for tracking -->
    <div id="info">
        Level: <span id="level">1</span> |
        Moves: <span id="moves">0</span> |
        Time: <span id="time">0:00</span>
    </div>
    <div id="message"></div>
</div>

<script>
    let level=1, numLevels=3, numDisks=3, moves=0;
    let selectedDisk=null, levelResults=[], timerInterval, levelStartTime;
    const towers=[document.getElementById("tower1"), document.getElementById("tower2"), document.getElementById("tower3")];

    function showInstructions(){
        document.getElementById("startScreen").style.display="none";
        document.getElementById("instructionScreen").style.display="flex";
    }

    function startGame(){
        document.getElementById("instructionScreen").style.display="none";
        document.getElementById("gameSection").style.display="flex";
        initGame();
    }

    function startTimer(){
        levelStartTime=Date.now();
        timerInterval=setInterval(()=>{
            let elapsed=Math.floor((Date.now()-levelStartTime)/1000);
            let min=Math.floor(elapsed/60), sec=elapsed%60;
            document.getElementById("time").textContent=`${min}:${sec.toString().padStart(2,'0')}`;
        },1000);
    }

    function stopTimer(){
        clearInterval(timerInterval);
        return Math.floor((Date.now()-levelStartTime)/1000);
    }

    function initGame(){
        for(let t of towers) t.innerHTML="";
        for(let i=numDisks;i>=1;i--){
            const disk=document.createElement("div");
            disk.classList.add("disk");
            disk.style.width=(i*30)+"px";
            disk.textContent=i;
            towers[0].appendChild(disk);
        }
        moves=0;
        document.getElementById("moves").textContent=moves;
        document.getElementById("level").textContent=level;
        document.getElementById("message").textContent="";
        document.getElementById("time").textContent="0:00";
        startTimer();
    }

    towers.forEach(tower=>{
        tower.addEventListener("click",()=>{
            if(!selectedDisk){
                if(tower.lastElementChild){
                    selectedDisk=tower.lastElementChild;
                    selectedDisk.style.background="orange";
                }
            } else{
                const topDisk=tower.lastElementChild;
                if(!topDisk || parseInt(topDisk.textContent) > parseInt(selectedDisk.textContent)){
                    tower.appendChild(selectedDisk);
                    moves++;
                    document.getElementById("moves").textContent=moves;
                    checkWin();
                }
                selectedDisk.style.background="linear-gradient(to bottom,#4facfe,#00f2fe)";
                selectedDisk=null;
            }
        });
    });

    function checkWin(){
        if(towers[2].childElementCount===numDisks){
            let elapsed=stopTimer();

            // Save results (hidden)
            levelResults.push({level:level, moves:moves, time:elapsed});

            if(level<numLevels){
                document.getElementById("message").textContent=`âœ… Level ${level} completed! Moving to next level...`;
                setTimeout(()=>{ level++; numDisks++; initGame(); },2000);
            } else{
                // Send to Firebase parent
                window.parent.postMessage({game:"game3",result:levelResults},"*");
                document.getElementById("message").textContent=`ðŸŽ‰ You completed all ${numLevels} levels!`;
            }
        }
    }
</script>
</body>
</html>


